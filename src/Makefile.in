#
# Makefile for the common code library project. 
# This probably requires GNU make.
#

top_builddir=@top_builddir@
prefix=@prefix@
exec_prefix=@exec_prefix@
libdir=@libdir@
includedir=@includedir@

DEFS   = @DEFS@
CFLAGS = @CFLAGS@ $(DEFS)
LIBS   = @LIBS@
CC     = @CC@
LDFLAGS= @LDFLAGS@
RANLIB = @RANLIB@
LIBTOOL= @LIBTOOL@
INSTALL= @INSTALL@
SHELL  = @SHELL@

OBJS = crypt_random.o debug.o md5.o memory.o net_udp.o qfDES.o util.o hmac.o  \
       base64.o ntp.o rtp.o drand48.o mbus_parser.o mbus_config.o mbus_addr.o \
       mbus.o btree.o asarray.o @LIBOBJS@ rijndael-alg-fst.o \
       rijndael-api-fst.o sdp.o sap.o 

SRCS = $(OBJS:%.o=%.c)

all: version.h libuclmmbase.la

CCLD = $(CC)
libuclmmbase.la: $(OBJS:%.o=%.lo)
	$(LIBTOOL) --tag=CC --mode=link $(CCLD) $^ -o libuclmmbase.a
	$(LIBTOOL) --tag=CC --mode=link $(CCLD) $(LDFLAGS)-rpath $(libdir) -version-info 1 -shared $^ -o $@

version.h: ../VERSION
	sed -e 's/.*/#define CCL_VERSION "v&"/' $? > version.h

install: all
	test -d $(DESTDIR)$(includedir)/uclmmbase || \
		$(INSTALL) -d $(DESTDIR)$(includedir)/uclmmbase
	test -d "$(DESTDIR)$(libdir)" || \
		$(INSTALL) -d "$(DESTDIR)$(libdir)"
	$(LIBTOOL) --mode=install $(INSTALL) libuclmmbase.la $(DESTDIR)$(libdir)
	for header in *.h; do $(INSTALL) $$header $(DESTDIR)$(includedir)/uclmmbase/$(header); done

.c.o:
	$(CC) $(CFLAGS) $(INC) -c $<

%.lo: %.c
	$(LIBTOOL) --tag=CC --mode=compile $(CC)  $(CFLAGS) $(INC) -c $<

clean:
	-rm -f *.o *.lo version.h libuclmmbase.la libuclmmbase.a
	-rm -rf .libs

distclean:	clean
	-rm -f Makefile config.status config.cache uclconf.h

